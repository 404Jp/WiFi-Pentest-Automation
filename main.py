# main.py
from setup_wifi import setup_wifi_access_point
from scan_network import scan_network
from capture_traffic import capture_traffic
from metasploit_scan import metasploit_scan

def get_user_input():
    ssid = input("Enter the WiFi access point name: ")
    password = input("Enter the access point password (leave blank for no password): ")
    
    return ssid, password

def select_device():
    # Scan the network to get connected devices
    print("Scanning the network for connected devices...")
    scan_network()

    # Read the network scan results to identify devices
    devices = []
    with open('scan_results.txt', 'r') as file:
        for line in file:
            if 'Nmap scan report for' in line:
                devices.append(line.split('for ')[1].strip())
    
    if not devices:
        print("No devices found.")
        return None
    
    print("Found devices:")
    for idx, device in enumerate(devices):
        print(f"{idx + 1}. {device}")
    
    choice = int(input("Select the number of the device you want to audit: "))
    if 1 <= choice <= len(devices):
        return devices[choice - 1]
    else:
        print("Invalid selection.")
        return None

def run_automation():
    ssid, password = get_user_input()
    setup_wifi_access_point(ssid, password)

    # Wait a moment to ensure the access point is active
    import time
    time.sleep(10)
    
    ip_target = select_device()
    if ip_target:
        metasploit_scan(ip_target)
        capture_traffic()

if __name__ == "__main__":
    run_automation()
