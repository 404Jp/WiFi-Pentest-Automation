# setup_wifi.py
import subprocess

def setup_wifi_access_point(ssid, password=None):
    # Instalar dependencias
    subprocess.run(['sudo', 'apt', 'install', '-y', 'hostapd', 'dnsmasq'])

    # Configurar hostapd
    with open('/etc/hostapd/hostapd.conf', 'w') as hostapd_conf:
        hostapd_conf.write(f"""interface=wlp2s0
        driver=nl80211
        ssid={ssid}
        hw_mode=g
        channel=6
        {'wpa=2\nwpa_passphrase=' + password if password else ''}""")
    
    # Configurar dnsmasq
    with open('/etc/dnsmasq.conf', 'w') as dnsmasq_conf:
        dnsmasq_conf.write("interface=wlp2s0\ndhcp-range=192.168.50.10,192.168.50.50,255.255.255.0,12h")

    # Configurar interfaz de red
    subprocess.run(['sudo', 'ip', 'link', 'set', 'wlp2s0', 'up'])
    subprocess.run(['sudo', 'ip', 'addr', 'add', '192.168.50.1/24', 'dev', 'wlp2s0'])

    # Iniciar servicios
    subprocess.run(['sudo', 'hostapd', '/etc/hostapd/hostapd.conf'])
    subprocess.run(['sudo', 'dnsmasq', '-C', '/etc/dnsmasq.conf'])
